---
title: "Tandy Center Daily Data Reports"
output:
  github_document:
    html_preview: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
suppressPackageStartupMessages({
  library(obpg2tools)
  library(murtools)
  library(namforecast)
  library(oisster)
  library(ersst)
  
  library(knitr)
  library(dplyr)
})
```

Tallies of various data products maintained at [Tandy Center](https://www.bigelow.org/services/ocean-forecasting/) and the [Computational Oceanography Lab](https://www.bigelow.org/science/lab/computational-oceanography/)

 + `firstdate` `lastdate` first an last recorded dates (there may be some missing between)
 + `per` the period of time the variable represents
 + `param` short hand parameter name
 + `count` number of records available
 + `age` the time between the current report date, ```r Sys.Date()```, and the most recent record.  Negative is a forecast date ahead of run date.
 
## OBPG for Northwest Atlantic 

```{r, echo = FALSE}
path = obpg2tools::obpg_path("nwa", "AQUA_MODIS", "L3m")
db = obpg2tools::read_database(path) |>
  select(date, per, param) |>
  group_by(param, per) |> 
  group_map(
    function(tbl, key){
      count = nrow(tbl)
      lastdate = slice_max(tbl, order_by = date)$date
      age = Sys.Date() - slice_max(tbl, order_by = date)$date
      slice(tbl, 1) |>
        mutate(count = count, age = age) |>
        mutate(lastdate = lastdate, .after = date) |>
        rename(firstdate = date)
    }, .keep = TRUE) |>
  bind_rows()
knitr::kable(db)
```


## MUR for Northwest Atlantic

```{r, echo = FALSE}
path = murtools::mur_path("nwa")
db = murtools::read_database(path) |>
  select(date, per, param) |>
  group_by(param, per) |>
  group_map(
    function(tbl, key){
      count = nrow(tbl)
      lastdate = slice_max(tbl, order_by = date)$date
      age = Sys.Date() - slice_max(tbl, order_by = date)$date
      slice(tbl, 1) |>
        mutate(count = count, age = age) |>
        mutate(lastdate = lastdate, .after = date) |>
        rename(firstdate = date)
    }, .keep = TRUE) |>
  bind_rows()
knitr::kable(db)
```

## NAM for Northeast US and Eastern Canada

Negative age means days ahead of the current date.

```{r, echo = FALSE}
path = namforecast::nam_path("nwa", "forecast")
db = namforecast::read_database(path) |>
  select(date, param, trt) |>
  group_by(param, trt) |>
 group_map(
    function(tbl, key){
      count = nrow(tbl)
      lastdate = slice_max(tbl, order_by = date)$date
      age = Sys.Date() - slice_max(tbl, order_by = date)$date
      slice(tbl, 1) |>
        mutate(count = count, age = age) |>
        mutate(lastdate = lastdate, .after = date) |>
        rename(firstdate = date)
    }, .keep = TRUE) |>
  bind_rows()
knitr::kable(db)
```

## OISST for the world

```{r, echo = FALSE}
path = oisster::oisst_path("world")
db = oisster::read_database(path) |> 
  select(-param) |>
  group_by(per, trt) |>
  group_map(
      function(tbl, key){
        count = nrow(tbl)
        lastdate = slice_max(tbl, order_by = date)$date
        age = Sys.Date() - slice_max(tbl, order_by = date)$date
        slice(tbl, 1) |>
          mutate(count = count, age = age) |>
          mutate(lastdate = lastdate, .after = date) |>
          rename(firstdate = date)
      }, .keep = TRUE) |>
    bind_rows()
knitr::kable(db)
```

## ERSST for the world

```{r, echo = FALSE}
path = ersst::ersst_path("v5")
db = ersst::read_database(path) |> 
  select(-version) |>
  group_by(anomaly) |>
  group_map(
      function(tbl, key){
        count = nrow(tbl)
        lastdate = slice_max(tbl, order_by = date)$date
        age = Sys.Date() - slice_max(tbl, order_by = date)$date
        slice(tbl, 1) |>
          mutate(count = count, age = age) |>
          mutate(lastdate = lastdate, .after = date) |>
          rename(firstdate = date)
      }, .keep = TRUE) |>
    bind_rows()
knitr::kable(db)
```

